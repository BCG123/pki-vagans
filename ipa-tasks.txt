
playbook: ansible/ipa-playbook.yml

  play #1 (safe-guard against race condition):	TAGS: []
    wait for the node to be ready	TAGS: [bootstrap]

  play #2 (install IPA base system):	TAGS: []
    Check default route	TAGS: [bootstrap]
    Create some default route	TAGS: [bootstrap]
    Check nameserver in /etc/resolv.conf	TAGS: [bootstrap]
    Kick DHCP in case /etc/resolv.conf is missing nameserver	TAGS: [bootstrap]
    Check for dnf command	TAGS: [bootstrap, package-install]
    Auto select fastest DNF mirror	TAGS: [bootstrap, package-install]
    Refresh dnf cache	TAGS: [bootstrap, network, package-install]
    Install python2 and deps for ansible modules	TAGS: [bootstrap, network, package-install]
    Gather facts	TAGS: [bootstrap]
    Dump ssh-config	TAGS: [bootstrap]
    Dummy (for ansible.skip_tags)	TAGS: [dummy]
    DNF or YUM?	TAGS: [common]
    Default facts (enable_packages, enable_network)	TAGS: [common]
    Override enable_packages=true	TAGS: [common, package-install]
    Override enable_network=true	TAGS: [common, network]
    Get nmcli device info	TAGS: [common]
    Set nmcli device info fact	TAGS: [common]
    fix /etc/hosts	TAGS: [common]
    Set FQDN hostname	TAGS: [common]
    Get timedatectl information	TAGS: [common]
    Set timezone to UTC	TAGS: [common]
    Disable dnf repos to prevent network access	TAGS: [common]
    Enable dnf repos	TAGS: [common]
    Auto select fastest DNF mirror	TAGS: [common, package-install]
    Enable yum for Fedora	TAGS: [common, network, package-install]
    Disable yum repos to prevent network access	TAGS: [common]
    Enable yum repos	TAGS: [common]
    Auto-select fastest yum mirror	TAGS: [common, network, package-install]
    Install gpg command for COPR / rpm_key	TAGS: [common, network, package-copr, package-install]
    Add GPG for FreeIPA 4.3 COPR	TAGS: [common, network, package-copr, package-install]
    Enable FreeIPA 4.3 COPR	TAGS: [common, network, package-copr, package-install]
    upgrade all packages	TAGS: [common, network, package-install, package-upgrade]
    Create directory for custom RPMS	TAGS: [common, custom-rpms]
    Synchronize RPMs	TAGS: [common, custom-rpms]
    find custom RPMs	TAGS: [common, custom-rpms]
    install custom RPMs	TAGS: [common, custom-rpms]
    install selinux tools	TAGS: [common, network, package-install]
    disable selinux for 389-DS installation	TAGS: [common, lxc]
    install firewalld	TAGS: [firewall, network, package-install, pki]
    check for firewalld	TAGS: [common, firewall]
    Enable and start firewalld	TAGS: [common, firewall]
    Open firewall ports elemental services	TAGS: [common, firewall]
    Install rng tools	TAGS: [common, network, package-install]
    Start the rngd service	TAGS: [common]
    tty-less sudo	TAGS: [common]
    make a copy of original resolv.conf	TAGS: [ipa]
    Get default DNS	TAGS: [ipa]
    Get reverse zone	TAGS: [ipa]
    Set ipa master fact	TAGS: [ipa]
    install FreeIPA client package (Fedora)	TAGS: [ipa, network, package-install]
    install FreeIPA client package (RHEL / CentOS)	TAGS: [ipa, network, package-install]
    get IPA version	TAGS: [ipa]
    Check for /etc/ipa/ca.crt	TAGS: [ipa]
    Check for /etc/ipa/default.conf	TAGS: [ipa]
    Set ipa_installed fact	TAGS: [ipa]

  play #3 (install IPA server system):	TAGS: []
    install FreeIPA server package (Fedora)	TAGS: [ipaserver, network, package-install]
    install FreeIPA server package (RHEL / CentOS)	TAGS: [ipaserver, network, package-install]
    Open Firewall for services	TAGS: [firewall, ipaserver]
    Open Firewall for ports	TAGS: [firewall, ipaserver]

  play #4 (install FreeIPA server master):	TAGS: []
    Install FreeIPA master (5-7 minutes)	TAGS: [ipa-install, ipaserver-master]
    Install KRA on FreeIPA master (2-3 minutes)	TAGS: [ipa-install, ipaserver-master]
    Make sure named-pkcs11 DNS is restarted	TAGS: [ipa-install, ipaserver-master]
    wait for services to come up	TAGS: [ipa-install, ipaserver-master]
    Use FreeIPA DNS, nmcli conn modify ipv4.dns	TAGS: [ipa-install, ipaserver-master]
    Use FreeIPA DNS, nmcli conn modify ipv4.dns-search	TAGS: [ipa-install, ipaserver-master]
    Use FreeIPA DNS, nmcli conn modify ipv4.ignore-auto-dns	TAGS: [ipa-install, ipaserver-master]
    Restart NetworkManager to make DNS changes effective	TAGS: [ipa-install, ipaserver-master]
    Set sensible defaults	TAGS: [ipa-install, ipaserver-master]
    Set home directory to /export/home	TAGS: [ipa-install, ipaserver-master]
    Set admin's home directory to /export/home/admin	TAGS: [ipa-install, ipaserver-master]
    Enable password and OTP loging	TAGS: [ipa-install, ipaserver-master]
    Enable global DNS sync ptr	TAGS: [ipa-install, ipaserver-master]
    Enable DNS sync ptr	TAGS: [ipa-install, ipaserver-master]
    Enable reverse DNS sync ptr	TAGS: [ipa-install, ipaserver-master]
    signal FreeIPA master has been deployed	TAGS: [ipa-install, ipaserver-master]
    signal FreeIPA client has been configured	TAGS: [ipa, ipa-install]
    Create Firefox prefs	TAGS: [ipa-install, ipaserver-master]
    Fetch Firefox prefs	TAGS: [fetch, ipa-install, ipaserver-master]
    Write custom krb5.conf	TAGS: [ipa-install, ipaserver-master]
    Fetch krb5config	TAGS: [fetch, ipa-install, ipaserver-master]
    Fetch resolv.conf	TAGS: [fetch, ipa-install, ipaserver-master]
    Fetch cacert	TAGS: [fetch, ipa-install, ipaserver-master]
    Fetch ipa default.conf	TAGS: [fetch, ipa-install, ipaserver-master]
    Fetch kra agent pem file	TAGS: [fetch, ipa-install, ipaserver-master]

  play #5 (install FreeIPA server replica):	TAGS: []
    Create /export home directory with correct context	TAGS: [ipa-client, ipa-install]
    join FreeIPA	TAGS: [ipa-client, ipa-install]
    signal FreeIPA client has been configured	TAGS: [ipa, ipa-install]
    install replica	TAGS: [ipa-install, ipaserver-replica]
    Prepare replication	TAGS: [ipa-install, ipaserver-replica]
    Fetch replication file	TAGS: [fetch, ipa-install, ipaserver-replica]
    Copy replication file	TAGS: [ipa-install, ipaserver-replica]
    install replica	TAGS: [ipa-install, ipaserver-replica]
    flag replication installation	TAGS: [ipa-install, ipaserver-replica]
    signal FreeIPA client has been configured	TAGS: [ipa, ipa-install]

  play #6 (install FreeIPA client):	TAGS: []
    Create /export home directory with correct context	TAGS: [ipa-client, ipa-install]
    join FreeIPA	TAGS: [ipa-client, ipa-install]
    signal FreeIPA client has been configured	TAGS: [ipa, ipa-install]

  play #7 (install OpenConnect VPN server for FreeIPA):	TAGS: []
    install ocserv VPN server	TAGS: [ipa-vpnserver, network, package-install]
    Open Firewall services for ocserv VPN server	TAGS: [firewall, ipa-vpnserver]
    Open Firewall DTLS UDP port for ocserv VPN server	TAGS: [firewall, ipa-vpnserver]
    Get keytab /etc/ocserv/key.tab content	TAGS: [ipa-install, ipa-vpnserver]
    Create VPN service	TAGS: [ipa-install, ipa-vpnserver]
    Add VPN service to keytab /etc/ocserv/key.tab	TAGS: [ipa-install, ipa-vpnserver]
    Look for /etc/pki/ocserv/public/server.crt	TAGS: [ipa-install, ipa-vpnserver]
    Generate private key /etc/pki/ocserv/private/server.key	TAGS: [ipa-install, ipa-vpnserver]
    Create CSR template	TAGS: [ipa-install, ipa-vpnserver]
    Generate cert request file /etc/pki/ocserv/public/server.csr	TAGS: [ipa-install, ipa-vpnserver]
    Request certificate from FreeIPA	TAGS: [ipa-install, ipa-vpnserver]
    Fetch cert as /etc/pki/ocserv/public/server.crt	TAGS: [ipa-install, ipa-vpnserver]
    Create a link from /etc/pki/ocserv/cacerts/ca.crt to /etc/ipa/ca.crt	TAGS: [ipa-install, ipa-vpnserver]
    Write ocserv.conf	TAGS: [ipa-install, ipa-vpnserver]
    Enable ocserv	TAGS: [ipa-install, ipa-vpnserver]
    Write custom krb5.conf	TAGS: [ipa-install, ipa-vpnserver]
    Fetch krb5config	TAGS: [fetch, ipa-install, ipa-vpnserver]

  play #8 (install FreeIPA NFS server):	TAGS: []
    install nfs-utils	TAGS: [ipa-nfsserver, network, package-install]
    Open Firewall for NFS	TAGS: [firewall, ipa-nfsserver]
    Get keytab content	TAGS: [ipa-install, ipa-nfsserver]
    Create NFS service	TAGS: [ipa-install, ipa-nfsserver]
    Add NFS service to keytab	TAGS: [ipa-install, ipa-nfsserver]
    Create /exports/home	TAGS: [ipa-install, ipa-nfsserver]
    Add NFS export	TAGS: [ipa-install, ipa-nfsserver]
    Enable NFS server	TAGS: [ipa-install, ipa-nfsserver]
    add automount default location	TAGS: [ipa-install, ipa-nfsserver]
    add auto.home map	TAGS: [ipa-install, ipa-nfsserver]
    add auto.home to auto.master	TAGS: [ipa-install, ipa-nfsserver]
    automountkey-add default auto.home	TAGS: [ipa-install, ipa-nfsserver]
    Get FreeIPA users	TAGS: [ipa-install, ipa-nfs-homedirs, ipa-nfsserver]
    Create home directory for FreeIPA users	TAGS: [ipa-install, ipa-nfs-homedirs, ipa-nfsserver]
    Run ipa-client-automount on master, replicas and clients	TAGS: [ipa-install, ipa-nfsserver]

  play #9 (install FreeIPA Samba server):	TAGS: []
    install Samba dependencies	TAGS: [ipa-smbserver, network, package-install]
    Open Firewall for Samba	TAGS: [firewall, ipa-smbserver]
    setsebool samba_enable_home_dirs on	TAGS: [ipa-install, ipa-smbserver]
    Get keytab content	TAGS: [ipa-install, ipa-smbserver]
    Create CIFS service	TAGS: [ipa-install, ipa-smbserver]
    Add CIFS service to keytab	TAGS: [ipa-install, ipa-smbserver]
    Write smb.conf	TAGS: [ipa-install, ipa-smbserver]
    Enable Samba services	TAGS: [ipa-install, ipa-smbserver]

  play #10 (install FreeIPA Samba server):	TAGS: []
    install Apache modules	TAGS: [ipa-httpexample, network, package-install]
    Open Firewall for Apache	TAGS: [firewall, ipa-httpexample]
    setsebool allow_httpd_mod_auth_pam on	TAGS: [ipa-httpexample, ipa-install]
    setsebool httpd_dbus_sssd on	TAGS: [ipa-httpexample, ipa-install]
    Get keytab content	TAGS: [ipa-httpexample, ipa-install]
    Create HTTP service	TAGS: [ipa-httpexample, ipa-install]
    Add HTTP service to keytab	TAGS: [ipa-httpexample, ipa-install]
    chown /etc/httpd.keytab	TAGS: [ipa-httpexample, ipa-install]
    Add ldap_user_extra_attrs to sssd.conf	TAGS: [ipa-httpexample, ipa-install]
    Add [ifp]allowed_uids to sssd.conf	TAGS: [ipa-httpexample, ipa-install]
    Add [ifp]user_attributes to sssd.conf	TAGS: [ipa-httpexample, ipa-install]
    Add [ifp]user_attributes to sssd.conf	TAGS: [ipa-httpexample, ipa-install]
    Create Apache config for example	TAGS: [ipa-httpexample, ipa-install]
    Create Apache example app	TAGS: [ipa-httpexample, ipa-install]
    Create PAM service for Apache example app	TAGS: [ipa-httpexample, ipa-install]
    Enable Apache HTTPD service	TAGS: [ipa-httpexample, ipa-install]

