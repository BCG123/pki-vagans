=====
About
=====

Vagrant + Ansible for Dogtag PKI

Authors:
    Christian Heimes <cheimes@redhat.com>

Parts of the playbook are based on Adam Young's rippowam
https://github.com/admiyo/rippowam.

=====
Setup
=====

libvirt
=======

$ sudo dnf install ansible libvirt vagrant vagrant-libvirt
$ sudo systemctl enable libvirtd
$ sudo systemctl start libvirtd
$ sudo usermod -G libvirt -a YOUR_USER
$ newgrp libvirt

LXC (outdated)
==============

$ sudo dnf install ansible libvirt vagrant vagrant-lxc lxc-templates lxc-extras
$ sudo usermod -G vagrant -a YOUR_USER
$ newgrp vagrant # or restart your session

virtual network
---------------

edit /etc/lxc/default.conf
change lxc.network.link = virbr0

$ sudo systemctl enable libvirtd
$ sudo systemctl start libvirtd


===========
Use Vagrant
===========

create VM
---------

$ cd pki
$ vagrant up

Provision the VM again
----------------------

For example to update RPMs

$ vagrant provision

Log into VM
-----------

$ vagrant ssh

Destroy VM
----------

$ vagrant destroy

Install custom RPMs
-------------------

Copy or symlink files or directories with RPMs into pki/rpms. The Ansible
playbook will pick up all RPMs (even in symlinked and nested directory
structures) and install them.

Python 3 dependencies
---------------------

There is a shell script in pki/rpms that will download some dependencies.

forceful cleanup
----------------

rm -rf /var/lib/pki/ /var/log/pki/ /etc/sysconfig/pki-tomcat/ /etc/sysconfig/pki/tomcat/pki-tomcat/ /root/.dogtag/pki-tomcat /etc/pki/pki-tomcat/

